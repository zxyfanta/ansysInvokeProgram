# 激光毁伤仿真系统环境搭建指南

## 1. 系统要求

### 1.1 硬件要求
```yaml
minimum_requirements:
  cpu: "Intel i5-8400 或 AMD Ryzen 5 2600"
  memory: "16GB DDR4"
  storage: "256GB SSD"
  gpu: "集成显卡 (可选独立显卡用于加速)"
  
recommended_requirements:
  cpu: "Intel i7-12700K 或 AMD Ryzen 7 5800X"
  memory: "32GB DDR4"
  storage: "1TB NVMe SSD"
  gpu: "NVIDIA RTX 3070 或更高"
  network: "千兆以太网"
```

### 1.2 操作系统支持
- **Windows**: Windows 10/11 (64位) - 推荐
- **Linux**: RHEL 8+, CentOS 8+, Ubuntu 20.04+ (64位)
- **注意**: ANSYS 2021 R1 对操作系统版本有严格要求

## 2. ANSYS 2021 R1 安装配置

### 2.1 安装前准备

#### 2.1.1 Windows环境
```powershell
# 检查系统版本
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"

# 检查可用内存
wmic computersystem get TotalPhysicalMemory

# 检查磁盘空间
wmic logicaldisk get size,freespace,caption

# 关闭Windows Defender实时保护（安装期间）
Set-MpPreference -DisableRealtimeMonitoring $true
```

#### 2.1.2 Linux环境
```bash
# 检查系统信息
cat /etc/os-release
free -h
df -h

# 安装必要的系统包 (CentOS/RHEL)
sudo yum groupinstall "Development Tools"
sudo yum install gcc gcc-c++ gcc-gfortran
sudo yum install libXt libXext libXrender libXtst
sudo yum install mesa-libGL mesa-libGLU

# Ubuntu/Debian
sudo apt update
sudo apt install build-essential gfortran
sudo apt install libxt6 libxext6 libxrender1 libxtst6
sudo apt install libgl1-mesa-glx libglu1-mesa
```

### 2.2 ANSYS安装步骤

#### 2.2.1 获取安装文件
```bash
# 从ANSYS官方下载或企业内部服务器获取
# 文件结构示例:
ANSYS2021R1_WINX64/
├── setup.exe                    # Windows安装程序
├── INSTALL                      # Linux安装脚本
├── ansys_inc/
│   ├── v211/
│   └── shared_files/
└── license/
    └── ansyslmd.lic            # 许可证文件
```

#### 2.2.2 Windows安装
```powershell
# 以管理员身份运行PowerShell
# 挂载ISO或解压安装包
cd "D:\ANSYS2021R1_WINX64"

# 静默安装 (可选)
.\setup.exe -silent -install_dir "C:\Program Files\ANSYS Inc" -licserverinfo "1055@license-server.company.com"

# 或使用图形界面安装
.\setup.exe
```

#### 2.2.3 Linux安装
```bash
# 解压安装包
tar -xzf ANSYS2021R1_LINX64.tar.gz
cd ANSYS2021R1_LINX64

# 设置安装权限
chmod +x INSTALL

# 静默安装
sudo ./INSTALL -silent -install_dir /opt/ansys_inc -licserverinfo 1055@license-server.company.com

# 或交互式安装
sudo ./INSTALL
```

### 2.3 许可证配置

#### 2.3.1 许可证服务器配置
```bash
# 编辑许可证文件
sudo nano /opt/ansys_inc/shared_files/licensing/ansyslmd.lic

# 许可证文件内容示例
SERVER license-server.company.com 001122334455 1055
DAEMON ansyslmd /opt/ansys_inc/shared_files/licensing/linx64/ansyslmd
USE_SERVER

# 启动许可证服务
sudo /opt/ansys_inc/shared_files/licensing/linx64/lmgrd -c /opt/ansys_inc/shared_files/licensing/ansyslmd.lic

# 检查许可证状态
/opt/ansys_inc/shared_files/licensing/linx64/lmstat -a -c /opt/ansys_inc/shared_files/licensing/ansyslmd.lic
```

#### 2.3.2 环境变量设置
```bash
# Linux环境变量 (~/.bashrc)
export ANSYS_ROOT="/opt/ansys_inc/v211"
export PATH="$ANSYS_ROOT/ansys/bin:$PATH"
export ANSYSLMD_LICENSE_FILE="1055@license-server.company.com"

# Windows环境变量
setx ANSYS_ROOT "C:\Program Files\ANSYS Inc\v211"
setx PATH "%PATH%;%ANSYS_ROOT%\ansys\bin"
setx ANSYSLMD_LICENSE_FILE "1055@license-server.company.com"
```

## 3. Python开发环境配置

### 3.1 Python版本管理

#### 3.1.1 使用Conda (推荐)
```bash
# 下载并安装Miniconda
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh

# 创建专用环境
conda create -n laser_simulation python=3.8
conda activate laser_simulation

# 验证Python版本
python --version  # 应显示 Python 3.8.x
```

#### 3.1.2 使用pyenv (Linux/macOS)
```bash
# 安装pyenv
curl https://pyenv.run | bash

# 安装Python 3.8
pyenv install 3.8.10
pyenv local 3.8.10

# 创建虚拟环境
python -m venv laser_simulation_env
source laser_simulation_env/bin/activate
```

### 3.2 核心依赖库安装

#### 3.2.1 创建requirements.txt
```python
# requirements.txt
# ANSYS集成
ansys-mapdl-core==0.65.0
ansys-fluent-core==0.15.0
pyansys==0.61.0

# 数值计算
numpy==1.21.6
scipy==1.7.3
pandas==1.3.5

# 可视化
matplotlib==3.5.3
pyvista==0.37.0
vtk==9.2.2

# GUI开发
PyQt5==5.15.7
# 或者使用 PySide2==5.15.8

# 数据处理
h5py==3.7.0
netCDF4==1.6.1

# 报告生成
reportlab==3.6.12
jinja2==3.1.2
openpyxl==3.0.10

# 数据库
sqlalchemy==1.4.44
sqlite3  # Python内置

# 测试框架
pytest==7.2.0
pytest-cov==4.0.0
pytest-mock==3.10.0

# 开发工具
black==22.10.0
flake8==5.0.4
mypy==0.991
```

#### 3.2.2 安装依赖
```bash
# 激活虚拟环境
conda activate laser_simulation
# 或 source laser_simulation_env/bin/activate

# 升级pip
pip install --upgrade pip

# 安装依赖
pip install -r requirements.txt

# 验证关键库安装
python -c "import numpy; print('NumPy:', numpy.__version__)"
python -c "import ansys.mapdl.core; print('PyMAPDL installed successfully')"
```

### 3.3 ANSYS Python集成测试

#### 3.3.1 创建测试脚本
```python
# test_ansys_integration.py
import os
import sys
from ansys.mapdl.core import launch_mapdl

def test_ansys_connection():
    """测试ANSYS连接"""
    try:
        # 启动MAPDL
        mapdl = launch_mapdl(
            exec_file=os.path.join(os.environ['ANSYS_ROOT'], 'ansys', 'bin', 'ansys211'),
            run_location='./ansys_working',
            cleanup_on_exit=True
        )
        
        print(f"ANSYS版本: {mapdl.version}")
        print(f"工作目录: {mapdl.directory}")
        
        # 简单测试
        mapdl.prep7()
        mapdl.et(1, 'SOLID186')
        mapdl.block(0, 1, 0, 1, 0, 1)
        mapdl.esize(0.2)
        mapdl.vmesh('ALL')
        
        print(f"节点数: {mapdl.mesh.n_node}")
        print(f"单元数: {mapdl.mesh.n_elem}")
        
        # 清理并退出
        mapdl.exit()
        print("ANSYS集成测试成功!")
        return True
        
    except Exception as e:
        print(f"ANSYS集成测试失败: {e}")
        return False

if __name__ == "__main__":
    success = test_ansys_connection()
    sys.exit(0 if success else 1)
```

#### 3.3.2 运行集成测试
```bash
# 确保ANSYS环境变量已设置
echo $ANSYS_ROOT
echo $ANSYSLMD_LICENSE_FILE

# 运行测试
python test_ansys_integration.py
```

## 4. 开发工具配置

### 4.1 IDE配置 (VS Code推荐)

#### 4.1.1 安装VS Code扩展
```json
{
    "recommendations": [
        "ms-python.python",
        "ms-python.flake8",
        "ms-python.black-formatter",
        "ms-python.mypy-type-checker",
        "ms-toolsai.jupyter",
        "ms-vscode.cmake-tools",
        "redhat.vscode-yaml"
    ]
}
```

#### 4.1.2 VS Code配置文件
```json
// .vscode/settings.json
{
    "python.defaultInterpreterPath": "./laser_simulation_env/bin/python",
    "python.linting.enabled": true,
    "python.linting.flake8Enabled": true,
    "python.formatting.provider": "black",
    "python.testing.pytestEnabled": true,
    "python.testing.unittestEnabled": false,
    "files.associations": {
        "*.apdl": "fortran",
        "*.mac": "fortran"
    }
}
```

### 4.2 Git配置

#### 4.2.1 初始化仓库
```bash
# 初始化Git仓库
git init
git config user.name "Your Name"
git config user.email "your.email@company.com"

# 创建.gitignore
cat > .gitignore << EOF
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/

# ANSYS
*.rst
*.rth
*.rmg
*.rfl
*.esav
*.full
*.db
*.log
*.err
*.out
ansys_working/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Data
data/results/
data/temp/
*.h5
*.nc
EOF
```

## 5. 验证安装

### 5.1 完整环境验证脚本
```python
# verify_environment.py
import sys
import os
import subprocess
from pathlib import Path

def check_python_version():
    """检查Python版本"""
    version = sys.version_info
    if version.major == 3 and version.minor >= 8:
        print(f"✓ Python版本: {version.major}.{version.minor}.{version.micro}")
        return True
    else:
        print(f"✗ Python版本不符合要求: {version.major}.{version.minor}.{version.micro}")
        return False

def check_ansys_installation():
    """检查ANSYS安装"""
    ansys_root = os.environ.get('ANSYS_ROOT')
    if not ansys_root:
        print("✗ ANSYS_ROOT环境变量未设置")
        return False
    
    ansys_path = Path(ansys_root)
    if not ansys_path.exists():
        print(f"✗ ANSYS安装路径不存在: {ansys_root}")
        return False
    
    print(f"✓ ANSYS安装路径: {ansys_root}")
    return True

def check_python_packages():
    """检查Python包"""
    required_packages = [
        'numpy', 'scipy', 'pandas', 'matplotlib',
        'ansys.mapdl.core', 'pyvista', 'PyQt5'
    ]
    
    missing_packages = []
    for package in required_packages:
        try:
            __import__(package)
            print(f"✓ {package}")
        except ImportError:
            print(f"✗ {package}")
            missing_packages.append(package)
    
    return len(missing_packages) == 0

def check_license():
    """检查ANSYS许可证"""
    license_server = os.environ.get('ANSYSLMD_LICENSE_FILE')
    if not license_server:
        print("✗ ANSYSLMD_LICENSE_FILE环境变量未设置")
        return False
    
    print(f"✓ 许可证服务器: {license_server}")
    return True

if __name__ == "__main__":
    print("=== 环境验证开始 ===")
    
    checks = [
        check_python_version(),
        check_ansys_installation(),
        check_python_packages(),
        check_license()
    ]
    
    if all(checks):
        print("\n🎉 环境配置验证成功！可以开始开发工作。")
    else:
        print("\n❌ 环境配置存在问题，请检查上述错误项。")
        sys.exit(1)
```

运行验证：
```bash
python verify_environment.py
```

---

**环境搭建完成后，您就可以开始激光毁伤仿真系统的开发工作了！**
